'use client'

import { AnimatePresence, motion } from 'framer-motion'
import { useEffect, useState } from 'react'

import { useSplashStore } from '@/hooks/useSplashStore'

export const SplashScreen = () => {
  const MIN_DURATION = 2000
  const [show, setShow] = useState(true)
  const [minimumTimePassed, setMinimumTimePassed] = useState(false)

  const finish = useSplashStore((s) => s.finish)

  useEffect(() => {
    const timer = setTimeout(() => setMinimumTimePassed(true), MIN_DURATION)

    const handleLoaded = () => {
      setTimeout(() => {
        if (minimumTimePassed) setShow(false)
      }, 500)
    }

    if (document.readyState === 'complete') {
      handleLoaded()
    } else {
      window.addEventListener('load', handleLoaded)
    }

    return () => {
      clearTimeout(timer)
      window.removeEventListener('load', handleLoaded)
    }
  }, [minimumTimePassed])

  useEffect(() => {
    if (minimumTimePassed && document.readyState === 'complete') {
      setShow(false)
    }
  }, [minimumTimePassed])

  return (
    <AnimatePresence
      mode="wait"
      onExitComplete={() => {
        finish()
      }}
    >
      {show && (
        <motion.div
          className="fixed inset-0 z-99 flex items-center justify-center bg-primary"
          initial={{ opacity: 1 }}
          exit={{
            opacity: 0,
            transition: { duration: 0.8, ease: [0.22, 1, 0.36, 1] }
          }}
        >
          <motion.div
            initial={{ opacity: 0, scale: 0.95, y: 10 }}
            animate={{
              opacity: 1,
              scale: 1,
              y: 0,
              transition: {
                duration: 1.2,
                ease: [0.22, 1, 0.36, 1]
              }
            }}
            exit={{
              opacity: 0,
              scale: 1.05,
              transition: { duration: 0.6 }
            }}
            className="relative"
          >
            <svg
              width="208"
              height="101"
              viewBox="0 0 208 101"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
              className="h-auto w-48 md:w-64"
            >
              <motion.path
                d="M17 17 H191 V84 H17 Z"
                stroke="white"
                strokeWidth="6"
                strokeLinecap="square"
                strokeLinejoin="miter"
                initial={{ pathLength: 0, opacity: 0 }}
                animate={{
                  pathLength: 1,
                  opacity: 1,
                  transition: { duration: 1.5, delay: 0.2, ease: 'easeInOut' }
                }}
              />
              <motion.g
                initial={{ opacity: 0 }}
                animate={{
                  opacity: 1,
                  transition: { duration: 0.8, delay: 0.8 }
                }}
              >
                <path
                  d="M62.3408 64L54.2128 54.048V64H49.7328V41.664H54.2128V51.68L62.3408 41.664H67.7488L58.5328 52.736L68.0048 64H62.3408ZM78.0236 64.224C76.4663 64.224 75.0583 63.9573 73.7996 63.424C72.5623 62.8907 71.5809 62.1227 70.8556 61.12C70.1303 60.1173 69.7569 58.9333 69.7356 57.568H74.5356C74.5996 58.4853 74.9196 59.2107 75.4956 59.744C76.0929 60.2773 76.9036 60.544 77.9276 60.544C78.9729 60.544 79.7943 60.2987 80.3916 59.808C80.9889 59.296 81.2876 58.6347 81.2876 57.824C81.2876 57.1627 81.0849 56.6187 80.6796 56.192C80.2743 55.7653 79.7623 55.4347 79.1436 55.2C78.5463 54.944 77.7143 54.6667 76.6476 54.368C75.1969 53.9413 74.0129 53.5253 73.0956 53.12C72.1996 52.6933 71.4209 52.064 70.7596 51.232C70.1196 50.3787 69.7996 49.248 69.7996 47.84C69.7996 46.5173 70.1303 45.3653 70.7916 44.384C71.4529 43.4027 72.3809 42.656 73.5756 42.144C74.7703 41.6107 76.1356 41.344 77.6716 41.344C79.9756 41.344 81.8423 41.9093 83.2716 43.04C84.7223 44.1493 85.5223 45.7067 85.6716 47.712H80.7436C80.7009 46.944 80.3703 46.3147 79.7516 45.824C79.1543 45.312 78.3543 45.056 77.3516 45.056C76.4769 45.056 75.7729 45.28 75.2396 45.728C74.7276 46.176 74.4716 46.8267 74.4716 47.68C74.4716 48.2773 74.6636 48.7787 75.0476 49.184C75.4529 49.568 75.9436 49.888 76.5196 50.144C77.1169 50.3787 77.9489 50.656 79.0156 50.976C80.4663 51.4027 81.6503 51.8293 82.5676 52.256C83.4849 52.6827 84.2743 53.3227 84.9356 54.176C85.5969 55.0293 85.9276 56.1493 85.9276 57.536C85.9276 58.7307 85.6183 59.84 84.9996 60.864C84.3809 61.888 83.4743 62.7093 82.2796 63.328C81.0849 63.9253 79.6663 64.224 78.0236 64.224ZM102.964 41.664V45.28H93.6516V51.008H100.788V54.56H93.6516V64H89.1716V41.664H102.964ZM147.554 41.664C149.9 41.664 151.959 42.1227 153.73 43.04C155.522 43.9573 156.898 45.2693 157.858 46.976C158.839 48.6613 159.33 50.624 159.33 52.864C159.33 55.104 158.839 57.0667 157.858 58.752C156.898 60.416 155.522 61.7067 153.73 62.624C151.959 63.5413 149.9 64 147.554 64H139.746V41.664H147.554ZM147.394 60.192C149.74 60.192 151.554 59.552 152.834 58.272C154.114 56.992 154.754 55.1893 154.754 52.864C154.754 50.5387 154.114 48.7253 152.834 47.424C151.554 46.1013 149.74 45.44 147.394 45.44H144.226V60.192H147.394Z"
                  fill="white"
                />
                <path
                  d="M113.08 57.147C111.694 57.147 110.42 56.825 109.258 56.181C108.11 55.537 107.193 54.641 106.507 53.493C105.835 52.331 105.499 51.029 105.499 49.587C105.499 48.145 105.835 46.85 106.507 45.702C107.193 44.554 108.11 43.658 109.258 43.014C110.42 42.37 111.694 42.048 113.08 42.048C114.466 42.048 115.733 42.37 116.881 43.014C118.043 43.658 118.953 44.554 119.611 45.702C120.283 46.85 120.619 48.145 120.619 49.587C120.619 51.029 120.283 52.331 119.611 53.493C118.939 54.641 118.029 55.537 116.881 56.181C115.733 56.825 114.466 57.147 113.08 57.147ZM113.08 53.871C114.256 53.871 115.194 53.479 115.894 52.695C116.608 51.911 116.965 50.875 116.965 49.587C116.965 48.285 116.608 47.249 115.894 46.479C115.194 45.695 114.256 45.303 113.08 45.303C111.89 45.303 110.938 45.688 110.224 46.458C109.524 47.228 109.174 48.271 109.174 49.587C109.174 50.889 109.524 51.932 110.224 52.716C110.938 53.486 111.89 53.871 113.08 53.871ZM128.959 57.147C127.573 57.147 126.299 56.825 125.137 56.181C123.989 55.537 123.072 54.641 122.386 53.493C121.714 52.331 121.378 51.029 121.378 49.587C121.378 48.145 121.714 46.85 122.386 45.702C123.072 44.554 123.989 43.658 125.137 43.014C126.299 42.37 127.573 42.048 128.959 42.048C130.345 42.048 131.612 42.37 132.76 43.014C133.922 43.658 134.832 44.554 135.49 45.702C136.162 46.85 136.498 48.145 136.498 49.587C136.498 51.029 136.162 52.331 135.49 53.493C134.818 54.641 133.908 55.537 132.76 56.181C131.612 56.825 130.345 57.147 128.959 57.147ZM128.959 53.871C130.135 53.871 131.073 53.479 131.773 52.695C132.487 51.911 132.844 50.875 132.844 49.587C132.844 48.285 132.487 47.249 131.773 46.479C131.073 45.695 130.135 45.303 128.959 45.303C127.769 45.303 126.817 45.688 126.103 46.458C125.403 47.228 125.053 48.271 125.053 49.587C125.053 50.889 125.403 51.932 126.103 52.716C126.817 53.486 127.769 53.871 128.959 53.871Z"
                  fill="white"
                />
                <line x1="107" y1="62" x2="120" y2="62" stroke="white" strokeWidth="4" />
                <line x1="123" y1="62" x2="136" y2="62" stroke="white" strokeWidth="4" />
              </motion.g>
            </svg>
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  )
}
